import { Tree, TreeItem } from "./tree";
export class OutlineTree extends Tree {
    createTreeItem(heading, parent, depth) {
        let item = new OutlineTreeItem(this, parent, depth);
        item.title = heading.heading;
        item.href = "#" + heading.heading.replaceAll(" ", "_");
        return item;
    }
    constructor(file, minDepth = 1) {
        var _a, _b, _c, _d;
        super();
        this.minDepth = 1;
        this.depth = 0;
        this.minDepth = minDepth;
        let headings = (_b = (_a = app.metadataCache.getFileCache(file)) === null || _a === void 0 ? void 0 : _a.headings) !== null && _b !== void 0 ? _b : [];
        if (headings.length > 0 && (headings[0].level != 1 && minDepth <= 1 && headings[0].heading != file.basename))
            headings.unshift({ heading: file.basename, level: 1, position: { start: { col: 0, line: 0, offset: 0 }, end: { col: 0, line: 0, offset: 0 } } });
        this.depth = Math.min(...headings.map(h => h.level)) - 1;
        let parent = this;
        for (let heading of headings) {
            if (heading.level < minDepth)
                continue;
            if (heading.level > parent.depth) {
                let child = this.createTreeItem(heading, parent, heading.level);
                parent.children.push(child);
                if (heading.level == parent.depth + 1)
                    parent = child;
            }
            else if (heading.level == parent.depth) {
                if (parent instanceof OutlineTreeItem) {
                    let child = this.createTreeItem(heading, parent.parent, heading.level);
                    parent.parent.children.push(child);
                    parent = child;
                }
            }
            else if (heading.level < parent.depth) {
                if (parent instanceof OutlineTreeItem) {
                    let levelChange = parent.depth - heading.level;
                    let backParent = (_c = parent.parent) !== null && _c !== void 0 ? _c : parent;
                    for (let i = 0; i < levelChange; i++) {
                        if (backParent instanceof OutlineTreeItem)
                            backParent = (_d = backParent.parent) !== null && _d !== void 0 ? _d : backParent;
                    }
                    let child = this.createTreeItem(heading, backParent, heading.level);
                    backParent.children.push(child);
                    parent = child;
                }
            }
        }
    }
}
export class OutlineTreeItem extends TreeItem {
    constructor(tree, parent, depth) {
        super(tree, parent, depth);
        this.children = [];
    }
    forAllChildren(func, recursive = true) {
        super.forAllChildren(func, recursive);
    }
    isCollapsible() {
        return super.isCollapsible() && this.depth > 1;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3V0bGluZS10cmVlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsib3V0bGluZS10cmVlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBR3hDLE1BQU0sT0FBTyxXQUFZLFNBQVEsSUFBSTtJQU01QixjQUFjLENBQUMsT0FBcUIsRUFBRSxNQUFxQyxFQUFFLEtBQWE7UUFFakcsSUFBSSxJQUFJLEdBQUcsSUFBSSxlQUFlLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNwRCxJQUFJLENBQUMsS0FBSyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUM7UUFDN0IsSUFBSSxDQUFDLElBQUksR0FBRyxHQUFHLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ3ZELE9BQU8sSUFBSSxDQUFDO0lBQ2IsQ0FBQztJQUVELFlBQW1CLElBQVcsRUFBRSxRQUFRLEdBQUcsQ0FBQzs7UUFFM0MsS0FBSyxFQUFFLENBQUM7UUFiRixhQUFRLEdBQVcsQ0FBQyxDQUFDO1FBQ3JCLFVBQUssR0FBVyxDQUFDLENBQUM7UUFjeEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7UUFFekIsSUFBSSxRQUFRLEdBQUcsTUFBQSxNQUFBLEdBQUcsQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQywwQ0FBRSxRQUFRLG1DQUFJLEVBQUUsQ0FBQztRQUNwRSxJQUFHLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLElBQUksUUFBUSxJQUFJLENBQUMsSUFBSSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUM7WUFBRSxRQUFRLENBQUMsT0FBTyxD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QUFxQixJQUFJO1FBRXRGLEtBQUssQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFUyxhQUFhO1FBRXRCLE9BQU8sS0FBSyxDQUFDLGFBQWEsRUFBRSxJQUFJLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO0lBQ2hELENBQUM7Q0FDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEhlYWRpbmdDYWNoZSwgVEZpbGUgfSBmcm9tIFwib2JzaWRpYW5cIjtcclxuaW1wb3J0IHsgVHJlZSwgVHJlZUl0ZW0gfSBmcm9tIFwiLi90cmVlXCI7XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIE91dGxpbmVUcmVlIGV4dGVuZHMgVHJlZVxyXG57XHJcblx0cHVibGljIGNoaWxkcmVuOiBPdXRsaW5lVHJlZUl0ZW1bXTtcclxuXHRwdWJsaWMgbWluRGVwdGg6IG51bWJlciA9IDE7XHJcblx0cHVibGljIGRlcHRoOiBudW1iZXIgPSAwO1xyXG5cclxuXHRwcml2YXRlIGNyZWF0ZVRyZWVJdGVtKGhlYWRpbmc6IEhlYWRpbmdDYWNoZSwgcGFyZW50OiBPdXRsaW5lVHJlZUl0ZW0gfCBPdXRsaW5lVHJlZSwgZGVwdGg6IG51bWJlcik6IE91dGxpbmVUcmVlSXRlbVxyXG5cdHtcclxuXHRcdGxldCBpdGVtID0gbmV3IE91dGxpbmVUcmVlSXRlbSh0aGlzLCBwYXJlbnQsIGRlcHRoKTtcclxuXHRcdGl0ZW0udGl0bGUgPSBoZWFkaW5nLmhlYWRpbmc7XHJcblx0XHRpdGVtLmhyZWYgPSBcIiNcIiArIGhlYWRpbmcuaGVhZGluZy5yZXBsYWNlQWxsKFwiIFwiLCBcIl9cIik7XHJcblx0XHRyZXR1cm4gaXRlbTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBjb25zdHJ1Y3RvcihmaWxlOiBURmlsZSwgbWluRGVwdGggPSAxKVxyXG5cdHtcclxuXHRcdHN1cGVyKCk7XHJcblxyXG5cdFx0dGhpcy5taW5EZXB0aCA9IG1pbkRlcHRoO1xyXG5cclxuXHRcdGxldCBoZWFkaW5ncyA9IGFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKT8uaGVhZGluZ3MgPz8gW107XHJcblx0XHRpZihoZWFkaW5ncy5sZW5ndGggPiAwICYmIChoZWFkaW5nc1swXS5sZXZlbCAhPSAxICYmIG1pbkRlcHRoIDw9IDEgJiYgaGVhZGluZ3NbMF0uaGVhZGluZyAhPSBmaWxlLmJhc2VuYW1lKSkgaGVhZGluZ3MudW5zaGlmdCh7aGVhZGluZzogZmlsZS5iYXNlbmFtZSwgbGV2ZWw6IDEsIHBvc2l0aW9uOiB7c3RhcnQ6IHtjb2w6IDAsIGxpbmU6IDAsIG9mZnNldDogMH0sIGVuZDoge2NvbDogMCwgbGluZTogMCwgb2Zmc2V0OiAwfX19KTtcclxuXHRcdHRoaXMuZGVwdGggPSBNYXRoLm1pbiguLi5oZWFkaW5ncy5tYXAoaCA9PiBoLmxldmVsKSkgLSAxO1xyXG5cclxuXHRcdGxldCBwYXJlbnQ6IE91dGxpbmVUcmVlSXRlbSB8IE91dGxpbmVUcmVlID0gdGhpcztcclxuXHRcdGZvciAobGV0IGhlYWRpbmcgb2YgaGVhZGluZ3MpXHJcblx0XHR7XHJcblx0XHRcdGlmIChoZWFkaW5nLmxldmVsIDwgbWluRGVwdGgpIGNvbnRpbnVlO1xyXG5cdFx0XHRcclxuXHRcdFx0aWYgKGhlYWRpbmcubGV2ZWwgPiBwYXJlbnQuZGVwdGgpXHJcblx0XHRcdHtcclxuXHRcdFx0XHRsZXQgY2hpbGQgPSB0aGlzLmNyZWF0ZVRyZWVJdGVtKGhlYWRpbmcsIHBhcmVudCwgaGVhZGluZy5sZXZlbCk7XHJcblx0XHRcdFx0cGFyZW50LmNoaWxkcmVuLnB1c2goY2hpbGQpO1xyXG5cdFx0XHRcdGlmKGhlYWRpbmcubGV2ZWwgPT0gcGFyZW50LmRlcHRoICsgMSkgcGFyZW50ID0gY2hpbGQ7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoaGVhZGluZy5sZXZlbCA9PSBwYXJlbnQuZGVwdGgpXHJcblx0XHRcdHtcclxuXHRcdFx0XHRpZihwYXJlbnQgaW5zdGFuY2VvZiBPdXRsaW5lVHJlZUl0ZW0pIFxyXG5cdFx0XHRcdHtcclxuXHRcdFx0XHRcdGxldCBjaGlsZCA9IHRoaXMuY3JlYXRlVHJlZUl0ZW0oaGVhZGluZywgcGFyZW50LnBhcmVudCwgaGVhZGluZy5sZXZlbCk7XHJcblx0XHRcdFx0XHRwYXJlbnQucGFyZW50LmNoaWxkcmVuLnB1c2goY2hpbGQpO1xyXG5cdFx0XHRcdFx0cGFyZW50ID0gY2hpbGQ7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKGhlYWRpbmcubGV2ZWwgPCBwYXJlbnQuZGVwdGgpXHJcblx0XHRcdHtcclxuXHRcdFx0XHRpZiAocGFyZW50IGluc3RhbmNlb2YgT3V0bGluZVRyZWVJdGVtKVxyXG5cdFx0XHRcdHtcclxuXHRcdFx0XHRcdGxldCBsZXZlbENoYW5nZSA9IHBhcmVudC5kZXB0aCAtIGhlYWRpbmcubGV2ZWw7XHJcblx0XHRcdFx0XHRsZXQgYmFja1BhcmVudDogT3V0bGluZVRyZWVJdGVtIHwgT3V0bGluZVRyZWUgPSAocGFyZW50LnBhcmVudCBhcyBPdXRsaW5lVHJlZUl0ZW0gfCBPdXRsaW5lVHJlZSkgPz8gcGFyZW50O1xyXG5cdFx0XHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBsZXZlbENoYW5nZTsgaSsrKVxyXG5cdFx0XHRcdFx0e1xyXG5cdFx0XHRcdFx0XHRpZiAoYmFja1BhcmVudCBpbnN0YW5jZW9mIE91dGxpbmVUcmVlSXRlbSkgYmFja1BhcmVudCA9IChiYWNrUGFyZW50LnBhcmVudCBhcyBPdXRsaW5lVHJlZUl0ZW0gfCBPdXRsaW5lVHJlZSkgPz8gYmFja1BhcmVudDtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0bGV0IGNoaWxkID0gdGhpcy5jcmVhdGVUcmVlSXRlbShoZWFkaW5nLCBiYWNrUGFyZW50LCBoZWFkaW5nLmxldmVsKTtcclxuXHRcdFx0XHRcdGJhY2tQYXJlbnQuY2hpbGRyZW4ucHVzaChjaGlsZCk7XHJcblx0XHRcdFx0XHRwYXJlbnQgPSBjaGlsZDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcblxyXG5leHBvcnQgY2xhc3MgT3V0bGluZVRyZWVJdGVtIGV4dGVuZHMgVHJlZUl0ZW1cclxue1xyXG5cdHB1YmxpYyBjaGlsZHJlbjogT3V0bGluZVRyZWVJdGVtW10gPSBbXTtcclxuXHRwdWJsaWMgcGFyZW50OiBPdXRsaW5lVHJlZUl0ZW0gfCBPdXRsaW5lVHJlZTtcclxuXHJcblx0cHVibGljIGNvbnN0cnVjdG9yKHRyZWU6IE91dGxpbmVUcmVlLCBwYXJlbnQ6IE91dGxpbmVUcmVlSXRlbSB8IE91dGxpbmVUcmVlLCBkZXB0aDogbnVtYmVyKVxyXG5cdHtcclxuXHRcdHN1cGVyKHRyZWUsIHBhcmVudCwgZGVwdGgpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGZvckFsbENoaWxkcmVuKGZ1bmM6IChjaGlsZDogT3V0bGluZVRyZWVJdGVtKSA9PiB2b2lkLCByZWN1cnNpdmU6IGJvb2xlYW4gPSB0cnVlKVxyXG5cdHtcclxuXHRcdHN1cGVyLmZvckFsbENoaWxkcmVuKGZ1bmMsIHJlY3Vyc2l2ZSk7XHJcblx0fVxyXG5cclxuXHRwcm90ZWN0ZWQgaXNDb2xsYXBzaWJsZSgpOiBib29sZWFuIFxyXG5cdHtcclxuXHRcdHJldHVybiBzdXBlci5pc0NvbGxhcHNpYmxlKCkgJiYgdGhpcy5kZXB0aCA+IDE7XHJcblx0fVxyXG59XHJcbiJdfQ==